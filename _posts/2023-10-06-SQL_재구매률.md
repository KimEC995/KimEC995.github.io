<!-- ---
title: SQL실습- 재구매율 구하기
author: Kimec995
date: 2023-10-0 00:13:00 +09:00
categories: [SQL, Apply]
tags: [SQL, MySQL, Basic]
pin: true
math: true
mermaid: true
--- -->

SQL 문법을 몇 가지 살펴봤었다.

문제를 풀어보자.


## 문제: 국가 별 재구매율 구하기

재구매율은 특정 기간 1(ex.2003년) 구매자들 중 특정 기간 2(ex.2004년) 에도 구매한 구매자의 비중이다.

사용하는 데이터는 [MYSQL SampleDATA](https://www.mysqltutorial.org/mysql-sample-database.aspx) 이다.

전체 플로우를 생각해보면.

---

1. 과거주문 A와 현재주문 B를 비교.

2. 주문 A와 주문 B의 `구매자가 동일`한 경우 찾기

3. 주문 A의 연도와 주문 B의 연도 비교하기. A가 B보다 1년 이전 : `A == B-1`

4. 

---
우선 해당 데이터를 가져온 후.

```
USE classicmodels;
```

## 

![image.png](/\assets\img\postimg\SQL_WHERE\image-18.png)

ERD를 얼추 살펴보니

- orders : customerNumber, orderDate

2단계에서 필요한 `이전연도- 구매자(A) | 이후연도- 구매자(A)` 는 하나의 테이블에서 해결할 수 있어 보인다.

SELF JOIN으로 데이터를 추출하자.

```
SELECT 
	A.customerNumber
    , B.customerNumber
    , A.orderDate
    , B.country
FROM orders A
LEFT JOIN customers B
ON A.customerNumber = B.customerNumber
LIMIT 5
;
```

`orders` 테이블을 A와 B로 선언하고